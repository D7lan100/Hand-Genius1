<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hand&Genius</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body { 
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh; 
      margin: 0; 
    }
    .navbar-custom { 
      background: linear-gradient(90deg, #0080FF, #3399FF); 
      border-bottom: 2px solid rgba(255,255,255,0.1);
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    }
    .navbar-custom .navbar-brand, .navbar-custom .nav-link { 
      color: white !important; 
      font-weight: 500;
    }
    .navbar-brand img { filter: brightness(0) invert(1); transition: all 0.3s ease; }
    .navbar-brand:hover img { transform: scale(1.05); }
    .navbar-custom .nav-link:hover { color: #cce7ff !important; }

    /* PRODUCTOS */
    .product-card { 
      background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
      padding: 25px 20px;
      text-align: center;
      border-radius: 20px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08), 0 2px 10px rgba(0,0,0,0.05);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 1px solid rgba(255,255,255,0.8);
      position: relative;
      overflow: hidden;
      height: 100%;
    }
    .product-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0,128,255,0.1), transparent);
      transition: left 0.6s ease;
    }
    .product-card:hover::before { left: 100%; }
    .product-card:hover { transform: translateY(-10px) scale(1.02); box-shadow: 0 20px 40px rgba(0,128,255,0.15), 0 10px 25px rgba(0,0,0,0.1); border-color: rgba(0,128,255,0.3); }
    .product-image-container { position: relative; margin-bottom: 15px; border-radius: 15px; overflow: hidden; background: linear-gradient(45deg, #f1f3f4, #e8eaed); height: 140px; display: flex; align-items: center; justify-content: center; }
    .product-image { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease; }
    .product-card:hover .product-image { transform: scale(1.05); }
    .no-image-placeholder { color: #6c757d; font-size: 48px; opacity: 0.5; }
    .product-category { background: linear-gradient(135deg, #0080FF, #3399FF); color: white !important; padding: 6px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; display: inline-block; box-shadow: 0 3px 10px rgba(0,128,255,0.3); }
    .product-name { color: #2d3748 !important; font-weight: 700; font-size: 18px; margin-bottom: 8px; line-height: 1.3; }
    .product-price { color: #0080FF !important; font-weight: 800; font-size: 22px; margin-bottom: 15px; text-shadow: 0 2px 4px rgba(0,128,255,0.1); }
    .product-status { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
    .status-badge { padding: 4px 10px; border-radius: 15px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; }
    .status-available { background: linear-gradient(135deg, #48bb78, #38a169); color: white; box-shadow: 0 2px 8px rgba(72,187,120,0.3); }
    .status-unavailable { background: linear-gradient(135deg, #f56565, #e53e3e); color: white; box-shadow: 0 2px 8px rgba(245,101,101,0.3); }
    .status-customizable { background: linear-gradient(135deg, #ed8936, #dd6b20); color: white; box-shadow: 0 2px 8px rgba(237,137,54,0.3); }
    .btn-vermas { background: linear-gradient(135deg, #0080FF, #3399FF); color: white !important; padding: 10px 25px; border: none; border-radius: 25px; font-weight: 600; text-decoration: none; display: inline-block; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 4px 15px rgba(0,128,255,0.3); text-transform: uppercase; letter-spacing: 0.5px; font-size: 12px; }
    .btn-vermas:hover { background: linear-gradient(135deg, #0066CC, #2685E6); transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,128,255,0.4); color: white !important; }

    /* Tabs */
    .tabs-custom { margin: 30px 0; text-align: center; }
    .tabs-custom button { margin: 0 15px; border-radius: 25px; border: 2px solid #0080FF; background: white; padding: 12px 30px; font-weight: 500; color: #0080FF; transition: all 0.3s ease; cursor: pointer; }
    .tabs-custom button:hover { background: #0080FF; color: white; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,128,255,0.3); }

    .main-title { color: #333; font-weight: 600; margin-bottom: 10px; }
    .main-description { color: #666; font-size: 16px; }
    .container { background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,249,250,0.8)); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); backdrop-filter: blur(10px); margin-top: 20px; }

    .no-products { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 15px; padding: 40px; display:none; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-custom px-3">
    <img src="{{ url_for('static', filename='img/logo2.png') }}" alt="Hand&Genius Logo" height="40" class="me-3">
    <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-3">
      <li class="nav-item"><a class="nav-link" href="{{ url_for('home_bp.home') }}">Inicio</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('suscripciones_bp.ver_suscripcion') }}">Suscripci√≥n</a></li>
      <li class="nav-item"><a class="nav-link" href="#">Sugerencias</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('navbar_bp.donaciones')}}">Donaciones</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('navbar_bp.contacto')}}">Contacto</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('navbar_bp.calendario') }}">Calendario</a></li>
    </ul>

    <div class="d-flex align-items-center">
      <a href="{{ url_for('carrito_bp.ver') }}" class="text-decoration-none text-white">
        <i class="bi bi-cart mx-3 fs-5"></i>
      </a>
      <div class="dropdown">
        <a class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" href="#" role="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-person-circle fs-4 me-2"></i>
          <span class="fw-medium">{{ current_user.nombre_completo }}</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-custom" aria-labelledby="userDropdown">
          <li>
            <a class="dropdown-item" href="{{ url_for('navbar_bp.actualizar_perfil') }}">
              <i class="bi bi-gear me-2"></i>
              Configuraci√≥n de Perfil
            </a>
          </li>
          <li>
            <button class="dropdown-item bg-gradient" type="button" data-bs-toggle="modal" data-bs-target="#logoutModal">
              <i class="bi bi-box-arrow-right me-2"></i>
              Cerrar sesi√≥n
            </button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Contenido principal -->
  <div class="container text-center my-4">
    <h5 class="main-title"><strong>Bienvenidos a Hand&Genius - {{ current_user.nombre_completo }}</strong></h5>
    <p class="main-description">Aplicativo web pensado especialmente para personas j√≥venes como t√∫, que les interese brindar regalos creativos y personalizados.</p>

    <!-- Botones de categor√≠a -->
    <div class="tabs-custom">
      <button id="btnProductos">Productos</button>
      <button id="btnFabricacion">Fabricaci√≥n</button>
    </div>

    <!-- FILTRO DE PRODUCTOS -->
    <div class="filter-container my-4 d-flex flex-wrap justify-content-center gap-3">
      <select class="form-select" aria-label="Filtro por categor√≠a" id="categoriaFiltro" name="categoria">
        <option value="">Todas las categor√≠as</option>
        {% for categoria in categorias %}
          <option value="{{ categoria.id_categoria }}">{{ categoria.nombre }}</option>
        {% endfor %}
      </select>
      <input type="text" class="form-control" placeholder="Buscar por nombre..." id="nombreFiltro" name="nombre">
      <button class="btn btn-primary" id="btnFiltrar">Filtrar</button>
    </div>

    <!-- Contenedor de productos -->
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4" id="productosContainer">
      {% for producto in productos %}
      <div class="col producto-item" data-categoria="{{ producto.id_categoria }}" data-nombre="{{ producto.nombre|lower }}">
        <div class="product-card">
          <div class="product-image-container">
            {% if producto.imagen %}
              <img src="{{ producto.imagen }}" alt="{{ producto.nombre }}" class="product-image">
            {% else %}
              <i class="bi bi-image no-image-placeholder"></i>
            {% endif %}
          </div>
          <div class="product-category">Producto</div>
          <div class="product-name">{{ producto.nombre }}</div>
          <div class="product-price">${{ "%.2f"|format(producto.precio) }}</div>
          <div class="product-status">
            {% if producto.disponible %}
              <span class="status-badge status-available">‚úì Disponible</span>
            {% else %}
              <span class="status-badge status-unavailable">‚úó No disponible</span>
            {% endif %}
            {% if producto.es_personalizable %}
              <span class="status-badge status-customizable">üé® Personalizable</span>
            {% endif %}
          </div>
          <a href="{{ url_for('productos_bp.detalle_producto', id=producto.id_producto) }}" class="btn-vermas">Ver m√°s</a>
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="alert no-products mt-4">
      <h5>No hay productos disponibles</h5>
      <p>¬°Vuelve m√°s tarde!</p>
    </div>
  </div>

  <!-- Modal cierre sesi√≥n -->
  <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header">
          <h5 class="modal-title" id="logoutModalLabel">Cerrar sesi√≥n</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          ¬øEst√°s seguro de que deseas cerrar sesi√≥n?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <form action="{{ url_for('auth_bp.logout_redirect') }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-danger">Cerrar sesi√≥n</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const btnProductos = document.getElementById('btnProductos');
    const btnFabricacion = document.getElementById('btnFabricacion');
    const productosItems = Array.from(document.querySelectorAll('.producto-item'));
    const btnFiltrar = document.getElementById('btnFiltrar');
    const categoriaFiltro = document.getElementById('categoriaFiltro');
    const nombreFiltro = document.getElementById('nombreFiltro');
    const alertaNoProductos = document.querySelector('.no-products');

    function filtrarProductos(categoriasPermitidas = null, nombre = null) {
      let visibles = 0;
      productosItems.forEach(producto => {
        const cat = producto.dataset.categoria;
        const nom = producto.dataset.nombre;

        let mostrar = true;
        if(categoriasPermitidas && !categoriasPermitidas.includes(cat)) mostrar = false;
        if(nombre && !nom.includes(nombre.toLowerCase())) mostrar = false;

        producto.style.display = mostrar ? "block" : "none";
        if(mostrar) visibles++;
      });
      alertaNoProductos.style.display = visibles === 0 ? "block" : "none";
    }

    // Botones categor√≠as
    btnProductos.addEventListener('click', () => filtrarProductos(["1","2","3"], nombreFiltro.value));
    btnFabricacion.addEventListener('click', () => filtrarProductos(["4","5"], nombreFiltro.value));

    // Filtro por inputs
    btnFiltrar.addEventListener('click', () => {
      const catValue = categoriaFiltro.value ? [categoriaFiltro.value] : null;
      const nombreValue = nombreFiltro.value.trim() || null;
      filtrarProductos(catValue, nombreValue);
    });

    // Mostrar productos por defecto (Productos 1,2,3)
    filtrarProductos(["1","2","3"]);
  </script>
</body>
</html>
